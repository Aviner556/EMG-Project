#include "buzzer.h"
#include "main.h"

BUZZ_STATE play = STATE_MUSIC_OFF;
extern TIM_HandleTypeDef htim6;
extern TIM_HandleTypeDef htim3;

int note[] = {390, 340, 303, 286, 255, 227, 202};
size_t size = sizeof(note)/sizeof(note[0]);
int currentNote = 0;
int tone = 3;
int sec = 9999;

void playNextNote()
{
	currentNote++;
	if(currentNote >= size){
		currentNote = 0;
	}
	playNote(currentNote);
}

void playNote(int noteIdx)
{
	currentNote = noteIdx;

	__HAL_TIM_SET_COUNTER(&htim3, 0);
	__HAL_TIM_SET_AUTORELOAD(&htim3, note[currentNote]);
	__HAL_TIM_SET_COMPARE(&htim3, TIM_CHANNEL_1, (note[currentNote])/2);

	__HAL_TIM_SET_COUNTER(&htim6, 0);
	__HAL_TIM_SET_AUTORELOAD(&htim6, sec/lenght[currentNote]);
}
